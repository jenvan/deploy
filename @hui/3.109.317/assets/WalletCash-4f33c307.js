import{o as u,c as b,h as r,j as x,n as _,F as z,i as B,t as m,r as J,a as i,e as V,d as l,b as a,f as c,w as v,v as g,p as M,k as Q}from"./index-3145bd2f.js";import{B as T}from"./BaseLayout-5af5a27a.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";const P={props:{number:{type:[String,Number],default:0},fg:{type:String,default:"#666"},bg:{type:String,default:"transparent"},size:String},data(){return{list:[]}},mounted(){this.scroll()},watch:{number(t,n){this.scroll()}},methods:{scroll(){let t=[];this.number.toString().split("").forEach(o=>{t.push(o)});let n=setInterval(()=>{let o=t.length;if(o==0){clearInterval(n);return}let e=t.pop();if(this.list[o-1]=e,e==".")return;let p=setInterval(()=>{this.list[o-1]++,this.list[o-1]>=10&&(this.list[o-1]=0),this.list[o-1]==e&&clearInterval(p)},30)},100)}}};function A(t,n,o,e,p,d){return u(),b("ul",{class:"card",style:_({background:o.bg,color:o.fg})},[r("li",{class:"slot",style:_({fontSize:o.size})},[x(t.$slots,"prepend",{},void 0,!0)],4),(u(!0),b(z,null,B(p.list,(f,y)=>(u(),b("li",{key:y,style:_({fontSize:o.size})},m(f),5))),128)),r("li",{class:"slot",style:_({fontSize:o.size})},[x(t.$slots,"default",{},void 0,!0)],4)],4)}const G=F(P,[["render",A],["__scopeId","data-v-a8b4bd35"]]);const K={components:{BaseLayout:T,NumberRoll:G},props:{action:{type:String,default:"deposit"}},setup(){return{state:J({stat:{balance:0,freez:0,transfer:0,deposit:0,withdrawal:0,consume:0,reward:0},num:100,remark:"微信充值",account:"",amount:0,tabs:["充值","提现"],active:0,type:"",loading:!1,finished:!1,list:[],offset:0,limit:20})}},created(){this.state.account=this.$store.openid,this.state.active=/withdraw/.test(this.action)?1:0,this.onChange()},methods:{onChange(){this.state.type=["deposit","withdrawal"][this.state.active],this.state.loading=!0,this.state.finished=!1,this.state.offset=0,this.state.list=[],this.onLoad(),this.$http.get("/property/summary?subject=cash").then(t=>this.state.stat=t)},onLoad(){this.$http.get("/property/cashlist?type="+this.state.type+"&offset="+this.state.offset+"&limit="+this.state.limit).then(t=>{(t.length==0||t.length<this.state.limit)&&(this.state.finished=!0),this.state.loading=!1,this.state.offset+=t.length;for(let n in t){let o=t[n];this.state.list.push({...o,amount:o.amount.replace(/(\.\d\d)(\d+)$/,"$1"),result:["待付款","交易完成","交易取消"][o.status],color:["#999","#090","#F66"][o.status]})}})},onQuery(){this.$http.post("/property/cashRequest?type=deposit&amount="+this.state.num+"&remark="+this.state.remark).then(t=>{t.code&&this.$dialog.alert({title:"请用微信扫码付款",message:"<img src='http://api.qrserver.com/v1/create-qr-code/?size=250x250&ecc=H&margin=10&data="+t.code+"'>",theme:"round-button",confirmButtonText:"我已完成付款",allowHtml:!0}).then(this.onChange)||WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",t,n=>{if(n.err_msg=="get_brand_wcpay_request:ok")return this.$dialog.alert({message:"充值成功"}).then(this.onChange);this.$toast("充值失败"),this.onChange()})}).catch(this.onChange)},onSubmit(){if(!/[\w]{10,}/.test(this.state.account))return this.$toast("提现账号不合要求");this.$http.post("/property/cashRequest?type=withdrawal&amount="+this.state.amount+"&detail="+this.state.account+"&remark=提现到微信零钱").then(this.onChange)},onCancel(t){this.$http.post("/property/cashCancel?id="+t).then(this.onChange)}}},O=t=>(M("data-v-1b6a2368"),t=t(),Q(),t),X={class:"stat"},Y={class:"title"},Z=O(()=>r("span",{class:"unit"},"元",-1)),$={class:"info"},tt={class:"deposit"},et={class:"slider-btn"};function at(t,n,o,e,p,d){const f=i("van-tab"),y=i("van-tabs"),I=i("van-tag"),L=i("number-roll"),C=i("van-field"),w=i("van-button"),h=i("van-col"),q=i("van-slider"),N=i("van-row"),U=i("van-form"),R=i("van-empty"),W=i("van-icon"),k=i("van-cell"),j=i("van-cell-group"),D=i("van-list"),E=i("BaseLayout");return u(),V(E,{title:"充值提现",bg:"#F9F9F9",height:0},{head:l(()=>[a(y,{active:e.state.active,"onUpdate:active":n[0]||(n[0]=s=>e.state.active=s),background:"transparent",color:"#3C6",type:"line",swipeable:"",animated:"",onChange:d.onChange},{default:l(()=>[a(f,{title:"充值"}),a(f,{title:"提现"})]),_:1},8,["active","onChange"])]),default:l(()=>[r("div",X,[r("div",Y,[a(I,{size:"large",color:"#3C6",plain:""},{default:l(()=>[c("累计"+m(e.state.tabs[e.state.active]),1)]),_:1})]),a(L,{number:e.state.active?Math.abs(e.state.stat.withdrawal):Math.abs(e.state.stat.deposit),fg:"#FFF",size:"32px"},{default:l(()=>[Z]),_:1},8,["number"])]),r("div",$,[v(r("div",tt,[a(C,{type:"number",min:"1",border:1,modelValue:e.state.num,"onUpdate:modelValue":n[1]||(n[1]=s=>e.state.num=s),"input-align":"right",clearable:"",label:"金额",placeholder:"请输入充值金额"},{extra:l(()=>[c(" 元")]),_:1},8,["modelValue"]),a(C,{modelValue:e.state.remark,"onUpdate:modelValue":n[2]||(n[2]=s=>e.state.remark=s),type:"text",maxlength:"20","input-align":"right",label:"备注",placeholder:"可以不填"},null,8,["modelValue"]),a(w,{round:"",block:"",color:"#0C6",onClick:d.onQuery},{default:l(()=>[c("立即充值")]),_:1},8,["onClick"])],512),[[g,!e.state.active]]),v(a(U,{class:"withdrawal",onSubmit:d.onSubmit},{default:l(()=>[a(N,{align:"center"},{default:l(()=>[a(h,{span:"7"},{default:l(()=>[c(" 收款账号： ")]),_:1}),a(h,{span:"17"},{default:l(()=>[a(C,{modelValue:e.state.account,"onUpdate:modelValue":n[3]||(n[3]=s=>e.state.account=s),type:"text",border:1,maxlength:"100",readonly:""},null,8,["modelValue"])]),_:1}),a(h,{span:"7"},{default:l(()=>[c(" 提现数量： ")]),_:1}),a(h,{span:"17"},{default:l(()=>[a(q,{class:"slider",modelValue:e.state.amount,"onUpdate:modelValue":n[4]||(n[4]=s=>e.state.amount=s),min:"10",max:"200",step:"1","active-color":"#0C6"},{button:l(()=>[r("div",et,m(e.state.amount),1)]),_:1},8,["modelValue"])]),_:1}),a(h,{span:"24"},{default:l(()=>[a(w,{round:"",block:"",color:"#0C6","native-type":"submit"},{default:l(()=>[c("申请提现")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"]),[[g,e.state.active]]),a(D,{loading:e.state.loading,"onUpdate:loading":n[5]||(n[5]=s=>e.state.loading=s),finished:e.state.finished,"loading-text":"正在请求数据 ...","finished-text":"没有更多了","immediate-check":!1,onLoad:d.onLoad},{default:l(()=>[v(a(R,null,null,512),[[g,e.state.list.length==0]]),(u(!0),b(z,null,B(e.state.list,(s,H)=>(u(),V(j,{class:"block",border:!1,key:H,onClick:S=>t.$toast(s.remark)},{default:l(()=>[a(k,{class:"dt",border:!1,title:s.dt},{extra:l(()=>[r("span",{style:_({color:s.color})},m(s.result),5),c("   #"+m(s.id)+" ",1),v(a(W,{class:"close",name:"close",size:"21",color:"#F00",onClick:S=>d.onCancel(s.id)},null,8,["onClick"]),[[g,s.status==0]])]),_:2},1032,["title"]),a(k,{class:"item",border:!1,title:s.remark,value:s.amount+" 元"},null,8,["title","value"]),a(k,{class:"detail",border:!1,value:s.detail,"is-link":"",onClick:S=>t.$copy(s.detail)},null,8,["value","onClick"])]),_:2},1032,["onClick"]))),128))]),_:1},8,["loading","finished","onLoad"])])]),_:1})}const lt=F(K,[["render",at],["__scopeId","data-v-1b6a2368"]]);export{lt as default};
